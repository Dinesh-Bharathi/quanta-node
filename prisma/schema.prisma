generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "windows", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model tbl_branches {
  branch_id        BigInt             @id @default(autoincrement())
  branch_uuid      String             @unique(map: "branch_uuid") @db.Char(8)
  tent_id          BigInt
  branch_name      String             @db.VarChar(150)
  is_hq            Boolean?           @default(false)
  address1         String?            @db.VarChar(255)
  address2         String?            @db.VarChar(255)
  country          String?            @db.VarChar(100)
  state            String?            @db.VarChar(100)
  postal_code      String?            @db.VarChar(20)
  phone_code       String?            @db.VarChar(10)
  phone            String?            @db.VarChar(20)
  status           Boolean?           @default(true)
  created_on       DateTime?          @default(now()) @db.Timestamp(0)
  modified_on      DateTime?          @default(now()) @db.Timestamp(0)
  tbl_tent_master1 tbl_tent_master1   @relation(fields: [tent_id], references: [tent_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_branches_tenant")
  tbl_tent_users1  tbl_tent_users1[]
  tbl_user_roles   tbl_user_roles[]
  tbl_user_tenants tbl_user_tenants[]

  @@index([tent_id], map: "tent_id")
}

model tbl_menus {
  menu_id              BigInt                 @id @default(autoincrement())
  menu_uuid            String                 @db.Char(8)
  menu_key             String                 @db.VarChar(100)
  menu_group           String?                @default("Management") @db.VarChar(100)
  is_main_menu         Boolean?               @default(true)
  is_footer_menu       Boolean?               @default(false)
  menu_name            String                 @db.VarChar(255)
  icon                 String?                @db.VarChar(100)
  path                 String?                @db.VarChar(255)
  parent_menu_id       BigInt?
  sort_order           Int?                   @default(0)
  created_on           DateTime?              @default(now()) @db.Timestamp(0)
  modified_on          DateTime?              @default(now()) @db.Timestamp(0)
  tbl_menus            tbl_menus?             @relation("tbl_menusTotbl_menus", fields: [parent_menu_id], references: [menu_id], onUpdate: Restrict, map: "fk_menus_parent")
  other_tbl_menus      tbl_menus[]            @relation("tbl_menusTotbl_menus")
  tbl_plan_menus       tbl_plan_menus[]
  tbl_role_permissions tbl_role_permissions[]

  @@index([parent_menu_id], map: "fk_menus_parent")
}

model tbl_plan_menus {
  id                     BigInt                 @id @default(autoincrement())
  plan_id                BigInt
  menu_id                BigInt
  tbl_subscription_plans tbl_subscription_plans @relation(fields: [plan_id], references: [plan_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_plan_menus_ibfk_1")
  tbl_menus              tbl_menus              @relation(fields: [menu_id], references: [menu_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_plan_menus_ibfk_2")

  @@unique([plan_id, menu_id], map: "uniq_plan_menu")
  @@index([menu_id], map: "menu_id")
}

model tbl_role_permissions {
  id         BigInt    @id @default(autoincrement())
  role_id    BigInt
  menu_id    BigInt
  can_read   Boolean?  @default(false)
  can_add    Boolean?  @default(false)
  can_update Boolean?  @default(false)
  can_delete Boolean?  @default(false)
  tbl_menus  tbl_menus @relation(fields: [menu_id], references: [menu_id], onUpdate: Restrict, map: "fk_role_permissions_menu")
  tbl_roles  tbl_roles @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_role_permissions_ibfk_1")

  @@unique([role_id, menu_id], map: "uniq_role_menu")
  @@index([menu_id], map: "fk_role_permissions_menu")
}

model tbl_roles {
  role_id              BigInt                 @id @default(autoincrement())
  role_uuid            String                 @unique(map: "role_uuid") @db.Char(8)
  tent_id              BigInt
  role_name            String                 @db.VarChar(100)
  description          String?                @db.VarChar(255)
  role_type            tbl_roles_role_type?   @default(CUSTOM)
  is_active            Boolean?               @default(true)
  created_by           BigInt?
  updated_by           BigInt?
  created_at           DateTime?              @default(now()) @db.Timestamp(0)
  updated_at           DateTime?              @db.Timestamp(0)
  tbl_role_permissions tbl_role_permissions[]
  tbl_tent_master1     tbl_tent_master1       @relation(fields: [tent_id], references: [tent_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_roles_ibfk_1")
  tbl_user_roles       tbl_user_roles[]

  @@unique([tent_id, role_name], map: "uniq_tenant_role")
  @@index([created_by], map: "idx_created_by")
  @@index([updated_by], map: "idx_updated_by")
}

model tbl_subscription_plans {
  plan_id                  BigInt                     @id @default(autoincrement())
  plan_uuid                String                     @unique(map: "plan_uuid") @db.Char(8)
  plan_name                String                     @unique(map: "plan_name") @db.VarChar(100)
  plan_description         String?                    @db.Text
  price_monthly            Decimal?                   @default(0.00) @db.Decimal(10, 2)
  price_yearly             Decimal?                   @default(0.00) @db.Decimal(10, 2)
  duration_days            Int?
  is_trial                 Boolean?                   @default(false)
  is_active                Boolean?                   @default(true)
  created_on               DateTime?                  @default(now()) @db.Timestamp(0)
  modified_on              DateTime?                  @default(now()) @db.Timestamp(0)
  tbl_plan_menus           tbl_plan_menus[]
  tbl_tenant_subscriptions tbl_tenant_subscriptions[]
}

model tbl_tenant_subscriptions {
  subscription_id        BigInt                                   @id @default(autoincrement())
  subscription_uuid      String                                   @unique(map: "subscription_uuid") @db.Char(8)
  tent_id                BigInt
  plan_id                BigInt
  start_date             DateTime                                 @db.DateTime(0)
  end_date               DateTime                                 @db.DateTime(0)
  is_active              Boolean?                                 @default(true)
  is_auto_renew          Boolean?                                 @default(true)
  payment_status         tbl_tenant_subscriptions_payment_status? @default(FREE)
  created_on             DateTime?                                @default(now()) @db.Timestamp(0)
  modified_on            DateTime?                                @default(now()) @db.Timestamp(0)
  tbl_tent_master1       tbl_tent_master1                         @relation(fields: [tent_id], references: [tent_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_tenant_subscriptions_ibfk_1")
  tbl_subscription_plans tbl_subscription_plans                   @relation(fields: [plan_id], references: [plan_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_tenant_subscriptions_ibfk_2")

  @@unique([tent_id, is_active], map: "uniq_tenant_active_plan")
  @@index([plan_id], map: "plan_id")
}

model tbl_tent_master1 {
  tent_id                  BigInt                     @id @default(autoincrement())
  tent_uuid                String                     @unique(map: "tent_uuid") @db.Char(8)
  tent_name                String                     @db.VarChar(100)
  tent_country_code        String?                    @db.VarChar(10)
  tent_phone               String?                    @db.VarChar(20)
  is_mobile_verified       Boolean?                   @default(false)
  tent_email               String?                    @unique(map: "tent_email") @db.VarChar(150)
  is_email_verified        Boolean?                   @default(false)
  tent_logo                String?                    @db.VarChar(255)
  tent_address1            String?                    @db.VarChar(255)
  tent_address2            String?                    @db.VarChar(255)
  tent_state               String?                    @db.VarChar(100)
  tent_country             String?                    @db.VarChar(100)
  tent_postalcode          String?                    @db.VarChar(20)
  tent_registration_number String?                    @db.VarChar(100)
  tent_status              Boolean?                   @default(true)
  created_on               DateTime?                  @default(now()) @db.Timestamp(0)
  modified_on              DateTime?                  @default(now()) @db.Timestamp(0)
  tbl_branches             tbl_branches[]
  tbl_roles                tbl_roles[]
  tbl_tenant_subscriptions tbl_tenant_subscriptions[]
  tbl_tent_users1          tbl_tent_users1[]
  tbl_user_tenants         tbl_user_tenants[]

  @@index([tent_registration_number], map: "idx_tent_registration_number")
}

model tbl_tent_users1 {
  user_id           BigInt            @id @default(autoincrement())
  tent_id           BigInt?
  branch_id         BigInt?
  user_uuid         String            @unique(map: "user_uuid") @db.Char(8)
  user_name         String            @db.VarChar(100)
  user_email        String            @db.VarChar(150)
  user_country_code String?           @db.VarChar(10)
  user_phone        String?           @db.VarChar(20)
  password          String?           @db.VarChar(255)
  is_owner          Boolean?          @default(false)
  created_on        DateTime?         @default(now()) @db.Timestamp(0)
  modified_on       DateTime?         @default(now()) @db.Timestamp(0)
  is_email_verified Boolean?          @default(false)
  tbl_branches      tbl_branches?     @relation(fields: [branch_id], references: [branch_id], onUpdate: Restrict, map: "fk_users_branch")
  tbl_tent_master1  tbl_tent_master1? @relation(fields: [tent_id], references: [tent_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_tent_users1_ibfk_1")

  @@index([branch_id], map: "idx_branch_id")
  @@index([tent_id], map: "tent_id")
}

model tbl_tokens {
  token_id       BigInt                @id @default(autoincrement())
  token          String                @unique(map: "token") @db.VarChar(255)
  token_type     tbl_tokens_token_type
  expires_at     DateTime              @db.DateTime(0)
  used_at        DateTime?             @db.DateTime(0)
  ip_address     String?               @db.VarChar(45)
  user_agent     String?               @db.VarChar(255)
  metadata       String?               @db.LongText
  created_on     DateTime?             @default(now()) @db.Timestamp(0)
  modified_on    DateTime?             @default(now()) @db.Timestamp(0)
  global_user_id BigInt?
  tbl_users      tbl_users?            @relation(fields: [global_user_id], references: [user_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_tokens_global_user")

  @@index([global_user_id], map: "global_user_id")
  @@index([expires_at], map: "idx_expires_at")
  @@index([token_type], map: "idx_token_type")
  @@index([used_at], map: "idx_used_at")
  @@index([token_type], map: "idx_user_token_type")
}

model tbl_user_roles {
  id               BigInt            @id @default(autoincrement())
  user_id          BigInt
  role_id          BigInt
  branch_id        BigInt?
  assigned_at      DateTime?         @default(now()) @db.Timestamp(0)
  assigned_by      BigInt?
  membership_id    BigInt?
  tbl_user_tenants tbl_user_tenants? @relation(fields: [membership_id], references: [id], onDelete: Cascade, onUpdate: Restrict, map: "fk_ur_membership")
  tbl_roles        tbl_roles         @relation(fields: [role_id], references: [role_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_user_roles_ibfk_2")
  tbl_branches     tbl_branches?     @relation(fields: [branch_id], references: [branch_id], onDelete: Cascade, onUpdate: Restrict, map: "tbl_user_roles_ibfk_3")

  @@unique([membership_id, role_id, branch_id], map: "uniq_membership_role_branch")
  @@index([membership_id, role_id, branch_id], map: "idx_membership_role_branch")
  @@index([user_id], map: "tbl_user_roles_ibfk_1")
  @@index([role_id], map: "tbl_user_roles_ibfk_2")
  @@index([branch_id], map: "tbl_user_roles_ibfk_3")
  @@index([assigned_by], map: "tbl_user_roles_ibfk_4")
}

model tbl_user_tenants {
  id               BigInt           @id @default(autoincrement())
  user_id          BigInt
  tent_id          BigInt
  branch_id        BigInt?
  is_owner         Boolean?         @default(false)
  created_on       DateTime?        @default(now()) @db.Timestamp(0)
  modified_on      DateTime?        @default(now()) @db.Timestamp(0)
  tbl_user_roles   tbl_user_roles[]
  tbl_branches     tbl_branches?    @relation(fields: [branch_id], references: [branch_id], onUpdate: Restrict, map: "fk_utt_branch")
  tbl_tent_master1 tbl_tent_master1 @relation(fields: [tent_id], references: [tent_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_utt_tent")
  tbl_users        tbl_users        @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_utt_user")

  @@unique([user_id, tent_id], map: "uniq_user_tenant")
  @@index([branch_id], map: "idx_branch_id")
  @@index([tent_id], map: "idx_tent_id")
  @@index([user_id], map: "idx_user_id")
}

model tbl_users {
  user_id           BigInt             @id @default(autoincrement())
  user_uuid         String             @unique(map: "user_uuid") @db.Char(8)
  user_name         String             @db.VarChar(100)
  user_email        String             @unique(map: "user_email") @db.VarChar(150)
  user_country_code String?            @db.VarChar(10)
  user_phone        String?            @db.VarChar(20)
  password          String?            @db.VarChar(255)
  is_email_verified Boolean?           @default(false)
  created_on        DateTime?          @default(now()) @db.Timestamp(0)
  modified_on       DateTime?          @default(now()) @db.Timestamp(0)
  tbl_tokens        tbl_tokens[]
  tbl_user_tenants  tbl_user_tenants[]
}

model tmp_user_map {
  old_user_id       BigInt  @id
  old_user_uuid     String? @db.Char(8)
  user_email        String? @db.VarChar(150)
  new_user_id       BigInt?
  new_membership_id BigInt?
}

enum tbl_tokens_token_type {
  PASSWORD_RESET
  EMAIL_VERIFICATION
  MAGIC_LINK
  FA                 @map("2FA")
  API_KEY
}

enum tbl_roles_role_type {
  SYSTEM
  CUSTOM
}

enum tbl_tenant_subscriptions_payment_status {
  PENDING
  SUCCESS
  FAILED
  FREE
}
